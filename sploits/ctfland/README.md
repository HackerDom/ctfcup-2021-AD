## Первая уязвимость

SSTI в генерируемом шаблоне для лендинга парка - есть возможность передавать команды через [поле email](https://github.com/HackerDom/ctfcup-2021-AD/blob/f489b5b92102d18527c9557db9ebe1be46e3bfb0/services/ctfland/src/Service/Models/CreateParkRequestModel.cs). 

На поле навешана валидация с помощью общего регулярного выражения и проверки через [MailAddress](https://docs.microsoft.com/ru-ru/dotnet/api/system.net.mail.mailaddress?view=netframework-4.8). Данный класс допускает строки вижа `"display name"<user@domain(comment)>`, а значит мы можем вызывать функции с помощью шаблонизатора. 

В [класс базового шаблона](https://github.com/HackerDom/ctfcup-2021-AD/blob/f489b5b92102d18527c9557db9ebe1be46e3bfb0/services/ctfland/src/Service/Views/ParkLandingTemplate.cshtml) видно, что к нему импортируется класс `userProvider`, который можно использовать для получения информации о пользователе по его идентификатору, в том числе паспортных данных (в них хранится первая часть флагов). 

Идентификаторы пользователей можно получить из страницы новых парков. 

Так как класс пользователя является типом `record`, в нем "из коробки" реализованы некоторые функции, в том числе удобный вывод значений полей. Поэтому если просто вывести объект класса, то в шаблоне можно увидеть паспортные данные, то есть флаг.

Пример payload'а для получения информации:

```
"123"@userProvider.GetUser(new Guid(0xA, 0xB, ...))
```



## Вторая уязвимость

Вторая часть флагов находится в билетах на аттракционы, однако купить их нет возможности из-за слишком высокой цены.

В реализации получения купленных билетов на аттракционы допущена [логическая ошибка](https://github.com/HackerDom/ctfcup-2021-AD/blob/f489b5b92102d18527c9557db9ebe1be46e3bfb0/services/ctfland/src/Service/Controllers/AuthController.cs) - среди аттракционов получаются аттракционы с такими же именами, но проверка по полю `parkId` пропущена.

Таким образом, если создать аттракцион в собственном парке с таким же именем, как у аттракциона с желаемым билетом, и купить его, то в профиле будут видны оба билета.

## Unintended

1. Возможность создать аттракцион с отрицательной стоиомтью
2. SSTI в $userLogin. Можно дописывать в конец преобразования. Например `$userLogin.Replace("a", "b")`.
